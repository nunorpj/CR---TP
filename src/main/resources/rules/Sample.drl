package com.sample
 import java.util.*;
//NOTAS
//
//Exam 0 = US
//Exam 1 = Repeat US
//Exam 2 = 4-phase CT
//Exam 3 = biopsy


//Regras de perguntas do paciente

rule "paciente tem cirrose"
	salience 100
    when
        $p : Paciente(cirrose == -1);
    then
    	System.out.println("o paciente " + $p.getNome()+ " tem cirrose?");
		
		Scanner input = new Scanner(System.in);
    	String result = input.nextLine();
		if(result.equalsIgnoreCase("sim")){
			$p.setCirrose(1);
		}else{
			$p.setCirrose(0);
		}
		update($p);
        
end

rule "child-pugh"
	salience 99
    when
        $p : Paciente(estadio == 'F');
    then
    	System.out.println("o paciente " + $p.getNome()+ " esta em que estagio de Child-Pugh?(A,B,C, 0 nunhum)");
		
		Scanner input = new Scanner(System.in);
    	char result =  input.next().charAt(0);
		if(result == 'a' || result == 'A'){
			$p.setEstadio('A');
		}else if(result == 'b' || result == 'B'){
			$p.setEstadio('B');
		}else if(result == 'c' || result == 'C'){
			$p.setEstadio('C');
		}else{
			$p.setEstadio('0');
		}
		update($p);
        
end

rule "paciente tem VHB"
	salience 98
    when
        $p : Paciente(VHB == -1);
    then
    	System.out.println("o paciente " + $p.getNome()+ " é portador cronico de VHB?");
		
		Scanner input = new Scanner(System.in);
    	String result = input.nextLine();
		if(result.equalsIgnoreCase("sim")){
			$p.setVHB(1);
		}else{
			$p.setVHB(0);
		}
		update($p);
        
end


rule "paciente tem hepatite ativa"
	salience 97
    when
        $p : Paciente(hepatite_ativa == -1);
    then
    	System.out.println("o paciente " + $p.getNome()+ " tem hepatite activa?");
		
		Scanner input = new Scanner(System.in);
    	String result = input.nextLine();
		if(result.equalsIgnoreCase("sim")){
			$p.setHepatite_ativa(1);
		}else{
			$p.setHepatite_ativa(0);
		}
		update($p);
        
end

rule "paciente com historia de familia de CHC "
	salience 96
    when
        $p : Paciente(historicoCHC == -1);
    then
    	System.out.println("o paciente " + $p.getNome()+ " tem algum familiar com historico de CHC?");
		
		Scanner input = new Scanner(System.in);
    	String result = input.nextLine();
		if(result.equalsIgnoreCase("sim")){
			$p.setHistoricoCHC(1);
		}else{
			$p.setHistoricoCHC(0);
		}
		update($p);
        
end

rule "paciente tem hepatite cronica "
	salience 95
    when
        $p : Paciente(HepatiteCronica == -1);
    then
    	System.out.println("o paciente " + $p.getNome()+ " tem hepatite crónica?");
		
		Scanner input = new Scanner(System.in);
    	String result = input.nextLine();
		if(result.equalsIgnoreCase("sim")){
			$p.setHepatiteCronica(1);
		}else{
			$p.setHepatiteCronica(0);
		}
		update($p);
        
end


rule "paciente tem fibrose hepatica avançada "
	salience 94
    when
        $p : Paciente(fibroseHipaticaAvançada == -1);
    then
    	System.out.println("o paciente " + $p.getNome()+ " tem fibrose hepatica avancada?");
		
		Scanner input = new Scanner(System.in);
    	String result = input.nextLine();
		if(result.equalsIgnoreCase("sim")){
			$p.setFibroseHipaticaAvançada(1);
		}else{
			$p.setFibroseHipaticaAvançada(0);
		}
		update($p);
        
end


rule "paciente esta a aguandar transplate hepatico"
	salience 93
    when
        $p : Paciente(aAguardarTransplanteHepático == -1);
    then
    	System.out.println("o paciente " + $p.getNome()+ " esta a aguandar transplate hepatico?");
		
		Scanner input = new Scanner(System.in);
    	String result = input.nextLine();
		if(result.equalsIgnoreCase("sim")){
			$p.setaAguardarTransplanteHepático(1);
		}else{
			$p.setaAguardarTransplanteHepático(0);
		}
		update($p);
        
end

//Regras para ver se o paciente é apto para vigilancia

rule "1 regra para determinar se o paciente deve ir para vigilancia"
	salience 92
    when
        $p : Paciente(aptoParaViginalancia == -1 && cirrose==1 && (estadio == 'A' || estadio == 'B'));
    then
        System.out.println("o "+$p.getNome() + " deve ir para vigilancia");
        $p.setAptoParaViginalancia(1);
		update($p); 
end

rule "2 regra para determinar se o paciente deve ir para vigilancia"
	salience 91
    when
        $p : Paciente(aptoParaViginalancia == -1 && cirrose==1 && estadio == 'C' && aAguardarTransplanteHepático ==1 );
    then
        System.out.println("o "+$p.getNome() + " deve ir para vigilancia");
        $p.setAptoParaViginalancia(1);
		update($p); 
end

rule "3 regra para determinar se o paciente deve ir para vigilancia"
	salience 90
    when
        $p : Paciente(aptoParaViginalancia == -1 && cirrose==0 && VHB == 1 && (hepatite_ativa == 1 || historicoCHC == 1) );
    then
        System.out.println("o "+$p.getNome() + " deve ir para vigilancia");
        $p.setAptoParaViginalancia(1);
		update($p); 
end

rule "4 regra para determinar se o paciente deve ir para vigilancia"
	salience 89
    when
        $p : Paciente(aptoParaViginalancia == -1 && cirrose==0 && HepatiteCronica == 1 && fibroseHipaticaAvançada == 1 );
    then
        System.out.println("o "+$p.getNome() + " deve ir para vigilancia");
        $p.setAptoParaViginalancia(1);
		update($p); 
end

rule " o paciente nao deve ir para vigilancia"
	salience 88
    when
        $p : Paciente(aptoParaViginalancia == -1 );
    then
        System.out.println("o "+$p.getNome() + "não deve ir para vigilancia, obrigado");
        $p.setAptoParaViginalancia(0);
        System.exit(0);
		update($p); 
end

//regras para analizar os nodulos

rule "US"
	salience 75
    when
        $n :Nodule(exame==0)
        not HCC();
    then
        System.out.println("What's the US result in nodule " + $n.getId() + "?");
    	Scanner input = new Scanner(System.in);
    	Float t = input.nextFloat();
    	$n.setTamanho(t);
    	if(t<1){
    		$n.setExame(1);
    		System.out.println("Stabel, repeat US at 4 mo");
    	}else {
    		$n.setExame(2);
        System.out.println("Nodulo with size " + t + "cm it's need a 4 -phase CT");
        }
        update($n);
        
end


rule "4-phase ct"
	salience 70
    when
        $n :Nodule(exame==2);
        not HCC();
    then
        System.out.println("How much positive tecniques in the 4-phase ct on nodule " + $n.getId() + "?");
    	Scanner input = new Scanner(System.in);
    	int nPositives = input.nextInt();
		if(nPositives == 0){
			System.out.println("It's needed an Biopsy!");
			$n.setExame(3);
		}else{
			System.out.println("Its HCC!");
			$n.setExame(4);
			insert(new HCC());
		}
		update($n);
end


rule "Biopsy"
	salience 60
    when
        $n :Nodule(exame==3);
        not HCC();
    then
        System.out.println("The Biopsy result on nodule " + $n.getId() + " was possitive?");
    	Scanner input = new Scanner(System.in);
    	String result = input.nextLine();
		if(result.equalsIgnoreCase("yes")){
			System.out.println("It's HCC!");
			insert(new HCC());
		}else{
			System.out.println("It's Inconclusive,please repeat US at 4 mo");
			$n.setExame(1);
		}
		update($n);
end


rule "HCC-stage"
	salience 50
    when
       exists $h : HCC();
    then
        System.out.println("Toi?");
end


